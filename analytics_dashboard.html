<!DOCTYPE html>
<html>
<head>
    <title>ECS Analytics Dashboard</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #2c3e50 0%, #34495e 25%, #2c3e50 50%, #34495e 75%, #2c3e50 100%); background-size: 400% 400%; animation: gradientShift 15s ease infinite; min-height: 100vh; margin: 0; display: flex; }
        .sidebar { width: 250px; background: rgba(44,62,80,0.95); backdrop-filter: blur(20px); border-right: 1px solid rgba(255,255,255,0.1); position: fixed; height: 100vh; z-index: 100; transition: all 0.3s; }
        .sidebar-header { padding: 25px 20px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .sidebar-title { color: #74b9ff; font-size: 1.3em; font-weight: bold; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        .sidebar-nav { padding: 20px 0; }
        .nav-item { display: block; padding: 15px 25px; color: rgba(255,255,255,0.8); text-decoration: none; transition: all 0.3s; border-left: 3px solid transparent; }
        .nav-item:hover { background: rgba(255,255,255,0.1); color: white; border-left-color: #74b9ff; }
        .nav-item.active { background: rgba(116,185,255,0.2); color: #74b9ff; border-left-color: #74b9ff; }
        .nav-item i { margin-right: 10px; width: 20px; text-align: center; }
        .main-content { margin-left: 250px; flex: 1; padding: 20px; }
        .sidebar-toggle { display: none; position: fixed; top: 20px; left: 20px; z-index: 101; background: rgba(116,185,255,0.2); color: #74b9ff; border: 1px solid rgba(116,185,255,0.4); padding: 10px; border-radius: 8px; cursor: pointer; backdrop-filter: blur(10px); }
        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); }
            .sidebar.open { transform: translateX(0); }
            .main-content { margin-left: 0; }
            .sidebar-toggle { display: block; }
        }
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .container { max-width: 1400px; margin: 0 auto; width: 100%; }
        .header { text-align: center; color: #2c3e50; margin-bottom: 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); color: white; }
        .header p { color: rgba(255,255,255,0.9); font-size: 1.1em; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; margin-bottom: 35px; }
        .stat-card { background: rgba(255,255,255,0.1); border-radius: 20px; padding: 25px; box-shadow: 0 15px 35px rgba(0,0,0,0.15); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.2); transition: all 0.3s; }
        .stat-card:hover { transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0,0,0,0.2); }
        .stat-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .stat-title { color: #74b9ff; font-size: 1.1em; font-weight: bold; text-shadow: 1px 1px 2px rgba(0,0,0,0.3); }
        .stat-icon { font-size: 2em; opacity: 0.8; }
        .stat-value { font-size: 2.5em; font-weight: bold; color: white; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); margin-bottom: 5px; }
        .stat-label { color: rgba(255,255,255,0.8); font-size: 0.9em; }
        .charts-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 25px; margin-bottom: 35px; }
        .chart-card { background: rgba(255,255,255,0.1); border-radius: 20px; padding: 25px; box-shadow: 0 15px 35px rgba(0,0,0,0.15); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.2); }
        .chart-title { color: #74b9ff; font-size: 1.3em; font-weight: bold; text-shadow: 1px 1px 2px rgba(0,0,0,0.3); margin-bottom: 20px; text-align: center; }
        .accounts-table { background: rgba(255,255,255,0.1); border-radius: 20px; padding: 25px; box-shadow: 0 15px 35px rgba(0,0,0,0.15); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.2); margin-bottom: 35px; }
        .table-title { color: #74b9ff; font-size: 1.4em; font-weight: bold; text-shadow: 1px 1px 2px rgba(0,0,0,0.3); margin-bottom: 20px; }
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1); }
        th { background: rgba(116,185,255,0.2); color: #74b9ff; font-weight: bold; text-shadow: 1px 1px 2px rgba(0,0,0,0.3); }
        td { color: white; }
        .status-active { color: #2ecc71; font-weight: bold; }
        .status-inactive { color: #e74c3c; font-weight: bold; }
        .health-good { color: #2ecc71; font-weight: bold; }
        .health-warning { color: #f39c12; font-weight: bold; }
        .health-critical { color: #e74c3c; font-weight: bold; }
        .health-error { color: #e74c3c; font-weight: bold; }
        .priority-high { color: #e74c3c; font-weight: bold; }
        .priority-medium { color: #f39c12; font-weight: bold; }
        .priority-low { color: #2ecc71; font-weight: bold; }
        .loading-spinner { border: 4px solid #f3f3f3; border-top: 4px solid #667eea; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .loading { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 40px; color: white; }
        .refresh-btn { background: linear-gradient(45deg, #00cec9, #00b894); color: white; border: none; padding: 12px 25px; border-radius: 25px; cursor: pointer; font-weight: bold; transition: all 0.3s; box-shadow: 0 5px 15px rgba(0,206,201,0.3); margin-bottom: 20px; }
        .refresh-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,206,201,0.4); }
        .recommendations-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; margin-bottom: 35px; }
        .recommendation-card { background: rgba(255,255,255,0.1); border-radius: 15px; padding: 20px; backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.2); transition: all 0.3s; }
        .recommendation-card:hover { transform: translateY(-3px); box-shadow: 0 15px 30px rgba(0,0,0,0.2); }
        .rec-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .rec-service { color: #74b9ff; font-weight: bold; font-size: 1.1em; }
        .rec-cluster { color: rgba(255,255,255,0.8); font-size: 0.9em; }
        .rec-badges { display: flex; gap: 8px; margin-bottom: 15px; }
        .badge { padding: 4px 12px; border-radius: 12px; font-size: 0.8em; font-weight: bold; text-transform: uppercase; }
        .badge-health-good { background: rgba(46,204,113,0.2); color: #2ecc71; border: 1px solid rgba(46,204,113,0.4); }
        .badge-health-warning { background: rgba(243,156,18,0.2); color: #f39c12; border: 1px solid rgba(243,156,18,0.4); }
        .badge-health-critical { background: rgba(231,76,60,0.2); color: #e74c3c; border: 1px solid rgba(231,76,60,0.4); }
        .badge-health-error { background: rgba(231,76,60,0.2); color: #e74c3c; border: 1px solid rgba(231,76,60,0.4); }
        .badge-priority-high { background: rgba(231,76,60,0.2); color: #e74c3c; border: 1px solid rgba(231,76,60,0.4); }
        .badge-priority-medium { background: rgba(243,156,18,0.2); color: #f39c12; border: 1px solid rgba(243,156,18,0.4); }
        .badge-priority-low { background: rgba(46,204,113,0.2); color: #2ecc71; border: 1px solid rgba(46,204,113,0.4); }
        .badge-scaling-scale_up { background: rgba(231,76,60,0.2); color: #e74c3c; border: 1px solid rgba(231,76,60,0.4); }
        .badge-scaling-scale_down { background: rgba(46,204,113,0.2); color: #2ecc71; border: 1px solid rgba(46,204,113,0.4); }
        .badge-scaling-no_change { background: rgba(149,165,166,0.2); color: #95a5a6; border: 1px solid rgba(149,165,166,0.4); }
        .rec-summary { color: rgba(255,255,255,0.9); font-size: 0.9em; line-height: 1.4; }
        .chart-container { position: relative; height: 300px; }
        .no-data { text-align: center; color: rgba(255,255,255,0.6); font-style: italic; padding: 40px; }
    </style>
</head>
<body>
    <button class="sidebar-toggle" onclick="toggleSidebar()">‚ò∞</button>

    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-title">üèóÔ∏è ECS Monitor</div>
        </div>
        <nav class="sidebar-nav">
            <a href="/" class="nav-item active">
                <i>üìà</i> Analytics
            </a>
            <a href="/services-dashboard" class="nav-item">
                <i>üè†</i> Services
            </a>
            <a href="/recommendations-dashboard" class="nav-item">
                <i>üìä</i> Recommendations
            </a>
            <a href="/cluster-dashboard" class="nav-item">
                <i>üéØ</i> Cluster Analysis
            </a>
            <a href="/add-account" class="nav-item">
                <i>‚ûï</i> Add Account
            </a>
        </nav>
    </div>

    <div class="main-content">
        <div class="container">
            <div class="header">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
                    <div>
                        <h1>üìà ECS Analytics Dashboard</h1>
                        <p>Comprehensive Infrastructure Analytics & Insights</p>
                    </div>
                    <div id="userInfo" style="text-align: right; color: rgba(255,255,255,0.9); font-size: 0.9em;">
                        <div style="background: rgba(255,255,255,0.15); padding: 12px 20px; border-radius: 15px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2);">
                            <div style="font-weight: bold; margin-bottom: 4px;">üë§ <span id="userName">Loading...</span></div>
                            <div style="font-size: 0.85em; opacity: 0.8;">üìß <span id="userEmail">Loading...</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <button class="refresh-btn" onclick="loadAnalyticsData()">üîÑ Refresh Analytics Data</button>

            <!-- High-Level Statistics -->
            <div class="stats-grid" id="statsGrid">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p style="margin-top: 15px;">Loading analytics data...</p>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="charts-grid" id="chartsGrid">
                <!-- Charts will be populated here -->
            </div>

            <!-- Accounts Overview Table -->
            <div class="accounts-table">
                <h3 class="table-title">üè¢ Accounts Overview</h3>
                <div class="table-container">
                    <table id="accountsTable">
                        <thead>
                            <tr>
                                <th>Account Name</th>
                                <th>Account ID</th>
                                <th>Region</th>
                                <th>Clusters</th>
                                <th>Services</th>
                                <th>Status</th>
                                <th>Last Updated</th>
                            </tr>
                        </thead>
                        <tbody id="accountsTableBody">
                            <tr>
                                <td colspan="7" class="loading">
                                    <div class="loading-spinner"></div>
                                    <p style="margin-top: 15px;">Loading accounts data...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Recent Recommendations -->
            <div class="accounts-table">
                <h3 class="table-title">ü§ñ Recent Service Recommendations</h3>
                <div id="recommendationsContainer">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p style="margin-top: 15px;">Loading recommendations data...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let analyticsData = {
            accounts: [],
            recommendations: {},
            stats: {}
        };

        async function loadUserInfo() {
            try {
                const resp = await fetch('/user-info');
                const userInfo = await resp.json();
                document.getElementById('userName').textContent = userInfo.name;
                document.getElementById('userEmail').textContent = userInfo.email;
            } catch (error) {
                console.error('Error loading user info:', error);
                document.getElementById('userName').textContent = 'Unknown User';
                document.getElementById('userEmail').textContent = 'unknown@example.com';
            }
        }

        async function loadAnalyticsData() {
            try {
                // Load comprehensive analytics data
                const analyticsResp = await fetch('/analytics-data');
                const data = await analyticsResp.json();

                if (data.error) {
                    showError(data.error);
                    return;
                }

                analyticsData = data;

                // Update UI
                updateStatsGrid();
                updateChartsGrid();
                updateAccountsTable();
                updateRecommendationsSection();

            } catch (error) {
                console.error('Error loading analytics data:', error);
                showError('Failed to load analytics data');
            }
        }

        // Remove calculateStatistics function as data comes pre-calculated from API

        function updateStatsGrid() {
            const data = analyticsData;
            const statsGrid = document.getElementById('statsGrid');

            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-title">AWS Accounts</div>
                        <div class="stat-icon">üè¢</div>
                    </div>
                    <div class="stat-value">${data.total_accounts}</div>
                    <div class="stat-label">${data.active_accounts} Active</div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-title">ECS Clusters</div>
                        <div class="stat-icon">üèóÔ∏è</div>
                    </div>
                    <div class="stat-value">${data.total_clusters}</div>
                    <div class="stat-label">Across all accounts</div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-title">ECS Services</div>
                        <div class="stat-icon">‚öôÔ∏è</div>
                    </div>
                    <div class="stat-value">${data.total_services}</div>
                    <div class="stat-label">Total services monitored</div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-title">Running Tasks</div>
                        <div class="stat-icon">üîß</div>
                    </div>
                    <div class="stat-value">${data.total_tasks}</div>
                    <div class="stat-label">Active container tasks</div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-title">AI Recommendations</div>
                        <div class="stat-icon">ü§ñ</div>
                    </div>
                    <div class="stat-value">${data.recommendations_summary.total}</div>
                    <div class="stat-label">Active recommendations</div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-title">High Priority</div>
                        <div class="stat-icon">üî¥</div>
                    </div>
                    <div class="stat-value">${data.recommendations_summary.by_priority.high}</div>
                    <div class="stat-label">High priority services</div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-title">Critical Services</div>
                        <div class="stat-icon">üö®</div>
                    </div>
                    <div class="stat-value">${data.recommendations_summary.by_health.critical + data.recommendations_summary.by_health.error}</div>
                    <div class="stat-label">Need immediate attention</div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-title">Scale Up Needed</div>
                        <div class="stat-icon">üìà</div>
                    </div>
                    <div class="stat-value">${data.recommendations_summary.by_scaling.scale_up}</div>
                    <div class="stat-label">Services need scaling up</div>
                </div>
            `;
        }

        function updateChartsGrid() {
            const stats = analyticsData.stats;
            const chartsGrid = document.getElementById('chartsGrid');

            chartsGrid.innerHTML = `
                <div class="chart-card">
                    <h3 class="chart-title">üè• Service Health Distribution</h3>
                    <div class="chart-container">
                        <canvas id="healthChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h3 class="chart-title">‚ö° Priority Distribution</h3>
                    <div class="chart-container">
                        <canvas id="priorityChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h3 class="chart-title">üìä Scaling Actions</h3>
                    <div class="chart-container">
                        <canvas id="scalingChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h3 class="chart-title">üè¢ Account Status</h3>
                    <div class="chart-container">
                        <canvas id="accountChart"></canvas>
                    </div>
                </div>
            `;

            // Create charts after DOM elements are created
            setTimeout(() => {
                createHealthChart();
                createPriorityChart();
                createScalingChart();
                createAccountChart();
            }, 100);
        }

        function createHealthChart() {
            const ctx = document.getElementById('healthChart').getContext('2d');
            const data = analyticsData.recommendations_summary.by_health;

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Good', 'Warning', 'Critical', 'Error'],
                    datasets: [{
                        data: [
                            data.good,
                            data.warning,
                            data.critical,
                            data.error
                        ],
                        backgroundColor: [
                            'rgba(46, 204, 113, 0.8)',
                            'rgba(243, 156, 18, 0.8)',
                            'rgba(231, 76, 60, 0.8)',
                            'rgba(192, 57, 43, 0.8)'
                        ],
                        borderColor: [
                            'rgba(46, 204, 113, 1)',
                            'rgba(243, 156, 18, 1)',
                            'rgba(231, 76, 60, 1)',
                            'rgba(192, 57, 43, 1)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: 'white',
                                font: { size: 12 }
                            }
                        }
                    }
                }
            });
        }

        function createPriorityChart() {
            const ctx = document.getElementById('priorityChart').getContext('2d');
            const data = analyticsData.recommendations_summary.by_priority;

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['High', 'Medium', 'Low'],
                    datasets: [{
                        label: 'Recommendations',
                        data: [
                            data.high,
                            data.medium,
                            data.low
                        ],
                        backgroundColor: [
                            'rgba(231, 76, 60, 0.8)',
                            'rgba(243, 156, 18, 0.8)',
                            'rgba(46, 204, 113, 0.8)'
                        ],
                        borderColor: [
                            'rgba(231, 76, 60, 1)',
                            'rgba(243, 156, 18, 1)',
                            'rgba(46, 204, 113, 1)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: 'white',
                                font: { size: 12 }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: 'white' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        x: {
                            ticks: { color: 'white' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    }
                }
            });
        }

        function createScalingChart() {
            const ctx = document.getElementById('scalingChart').getContext('2d');
            const data = analyticsData.recommendations_summary.by_scaling;

            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Scale Up', 'Scale Down', 'No Change'],
                    datasets: [{
                        data: [
                            data.scale_up,
                            data.scale_down,
                            data.no_change
                        ],
                        backgroundColor: [
                            'rgba(231, 76, 60, 0.8)',
                            'rgba(46, 204, 113, 0.8)',
                            'rgba(149, 165, 166, 0.8)'
                        ],
                        borderColor: [
                            'rgba(231, 76, 60, 1)',
                            'rgba(46, 204, 113, 1)',
                            'rgba(149, 165, 166, 1)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: 'white',
                                font: { size: 12 }
                            }
                        }
                    }
                }
            });
        }

        function createAccountChart() {
            const ctx = document.getElementById('accountChart').getContext('2d');
            const data = analyticsData;

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Active', 'Inactive'],
                    datasets: [{
                        data: [
                            data.active_accounts,
                            data.total_accounts - data.active_accounts
                        ],
                        backgroundColor: [
                            'rgba(46, 204, 113, 0.8)',
                            'rgba(231, 76, 60, 0.8)'
                        ],
                        borderColor: [
                            'rgba(46, 204, 113, 1)',
                            'rgba(231, 76, 60, 1)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: 'white',
                                font: { size: 12 }
                            }
                        }
                    }
                }
            });
        }

        function updateAccountsTable() {
            const accounts = analyticsData.accounts;
            const tbody = document.getElementById('accountsTableBody');

            if (accounts.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="no-data">No accounts found</td></tr>';
                return;
            }

            tbody.innerHTML = accounts.map(account => {
                return `
                    <tr>
                        <td>${account.account_name || 'N/A'}</td>
                        <td>${account.account_id}</td>
                        <td>${account.region || 'N/A'}</td>
                        <td>${account.clusters}</td>
                        <td>${account.services}</td>
                        <td><span class="status-${account.status}">${account.status.toUpperCase()}</span></td>
                        <td>${account.last_updated || 'Never'}</td>
                    </tr>
                `;
            }).join('');
        }

        function updateRecommendationsSection() {
            const recommendations = analyticsData.recent_recommendations;
            const container = document.getElementById('recommendationsContainer');

            if (recommendations.length === 0) {
                container.innerHTML = '<div class="no-data">No recommendations found</div>';
                return;
            }

            // Show only top 20 recommendations
            const topRecommendations = recommendations.slice(0, 20);

            container.innerHTML = `
                <div class="recommendations-grid">
                    ${topRecommendations.map(rec => {
                        const fullRec = rec.full_recommendation || {};
                        const recommendations = fullRec.recommendations || [];
                        const firstRec = recommendations[0] || 'No specific recommendations available';

                        return `
                            <div class="recommendation-card">
                                <div class="rec-header">
                                    <div>
                                        <div class="rec-service">${rec.service}</div>
                                        <div class="rec-cluster">üìç ${rec.cluster}</div>
                                    </div>
                                    <div style="text-align: right; font-size: 0.8em; color: rgba(255,255,255,0.6);">
                                        ${new Date(rec.timestamp).toLocaleDateString()}
                                    </div>
                                </div>
                                <div class="rec-badges">
                                    <span class="badge badge-health-${rec.service_health}">${rec.service_health}</span>
                                    <span class="badge badge-priority-${rec.priority}">${rec.priority}</span>
                                    <span class="badge badge-scaling-${rec.scaling_action}">${rec.scaling_action.replace('_', ' ')}</span>
                                </div>
                                <div class="rec-summary">
                                    ${firstRec.length > 100 ? firstRec.substring(0, 100) + '...' : firstRec}
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
                ${recommendations.length > 20 ?
                    `<div style="text-align: center; margin-top: 20px; color: rgba(255,255,255,0.7);">
                        Showing top 20 of ${recommendations.length} recommendations
                    </div>` : ''
                }
            `;
        }

        function showError(message) {
            document.getElementById('statsGrid').innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; color: #e74c3c; padding: 40px;">
                    <h3>‚ùå Error</h3>
                    <p>${message}</p>
                    <button class="refresh-btn" onclick="loadAnalyticsData()" style="margin-top: 15px;">üîÑ Retry</button>
                </div>
            `;
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('open');
        }

        // Initialize dashboard
        loadUserInfo();
        loadAnalyticsData();

        // Auto-refresh every 5 minutes
        setInterval(loadAnalyticsData, 300000);
    </script>
</body>
</html>
